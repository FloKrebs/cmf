<!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>cmf: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <span id="projectlogo"><img alt="cmf - the catchment modelling framework" src="cmf-logo-klein.png"/></span>
  <span style="padding-left: 2em;">
   <span id="projectname">cmf
   &#160;<span id="projectnumber">1.2.1a0</span>
   </span>
   <span id="projectbrief">The Catchment Modelling Framework</span>
  </span>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="contents">
<div class="textblock"><p><a class="el" href="_cmf_tut_start_8md.html">index...</a></p>
<h1>Channelled flow in cmf</h1>
<p>In this chapter, we will create a simple 1D river model using the kinematic wave equation with Manning's formula as the friction term. The approach is very similar to surface runoff, hence [wiki:CmfTutSurfaceRunoff] should be read before.</p>
<h2>Manning's formula</h2>
<p>[Mannig's formula](WikiPedia:Manning_formula) is an empirical formula to describe the flow velocity in a channel as a function of the channel geometry, depth, roughness and slope.</p>
<p class="formulaDsp">
\[ [q_{Manning}=|A R^{2/3}\frac{\sqrt{s}} {n} \]
</p>
<p>]</p>
<p>where:</p>
<ul>
<li>\(A = \frac V l\) : Crosssectional area of the wetted crossection, Volume per length) - \(R = \frac A {P(d)}\) : the hydraulic radius, given by the wetted crossection area per wetted perimeter - \(P(d)\) : the perimeter of the wetted crosssection, a function of reach depth, depending on channel geometry - \(d(V)\) : the depth of the reach, a function of the volume depending on channel geometry - \(s = \frac{\|z_1 - z_2\|}{l}\) : Slope of the reach - \(n\) : Manning friction roughness.</li>
</ul>
<p>Since the perimeter depends on the geometry of the channel crossection, this needs to be described. The way cmf handles channel geometry is given <a href="wiki:CmfTutCell#Riversandreaches">here</a></p>
<h2>Kinematic vs. Diffusive</h2>
<p>When you are using CMF, you have the choice between the kinematic wave approach, where the slope of the reach is given by the topographic slope, or the diffusive wave approach, where the slope is given by the slope of the water surface. Although the diffusive approach is more realistic, you are getting serious numerical trouble when using the diffusive wave. As you can see in the formula above, the flux depends on the square root of the slope. If the water surface levels out, the derivative of the square function goes to infinity and becomes hence infinite sensitive against value. As a result, any error controlled solver in cmf will fail for diffusive wave approaches when the water surface slope may go to zero. Unless we find a fix for this behaviour, please do <b>not</b> use diffusive wave approaches.</p>
<h2>Implementation</h2>
<p>Create a 1km river with 100 reaches along the x axis and a constant slope of 1%</p>
<div class="fragment"><div class="line">from __future__ import division, print_function #  Make code python 2/3 compatible</div><div class="line">import cmf</div><div class="line">from datetime import datetime,timedelta</div><div class="line">p=cmf.project()</div><div class="line"># Create a triangular reach crosssection for 10 m long reaches with a bankslope of 2</div><div class="line">shape = cmf.TriangularReach(10.,2.)</div><div class="line"># Create a 1km river with 100 reaches along the x axis and a constant slope of 1%</div><div class="line">reaches = [[p.NewReach(i,0,i*.01,shape,False)|for i in range(0,1000,10)]]</div></div><!-- fragment --><p>Now we have 100 unconnected reaches in our river. To connect them with kinematic wave equation</p>
<div class="fragment"><div class="line">for r_lower, r_upper in zip(reaches[:-1],reaches[1:]):</div><div class="line">    r_upper.set_downstream(r_lower)</div></div><!-- fragment --><p>Creating a solver and setting initial conditions:</p>
<div class="fragment"><div class="line"># Create a solver</div><div class="line">solver = cmf.CVodeIntegrator(p,1e-9)</div><div class="line"># Initial condition: 10 cmf of water in the most upper reach</div><div class="line">reaches[-1].depth=0.1</div></div><!-- fragment --><p>As always, the next part is the runtime code, saving the river depth.</p>
<div class="fragment"><div class="line"># We store the results in this list</div><div class="line">depth = [[r.depth for r in reaches]]</div><div class="line"># Run the model for 3 h with dt=1 min</div><div class="line">for t in solver.run(datetime(2012,1,1),datetime(2012,1,1,3), timedelta(minutes=1)):</div><div class="line">    depth.append([[r.depth|for r in reaches]])</div><div class="line">    print(t)</div></div><!-- fragment --><p>Finaly we are plotting the dynamic of the river depth over the run time</p>
<div class="fragment"><div class="line"># Plot the result (matplotlib needs to be installed)</div><div class="line">from matplotlib.pylab import plot, show</div><div class="line">plot(depth)</div><div class="line">show()</div></div><!-- fragment --><p>author: philipp, version: 10 Mon Oct 17 12:24:38 2016 </p>
</div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<div>&copy 2008-2017 by 
<a class="el" href="http://www.uni-giessen.de/hydro/kraft"> Philipp Kraft</a> and
<a class="el" href="http://www.uni-giessen.de/hydro"> 
Institute of Landscape Ecology and Resources Management,University of Gie&szlig;en</a>
</h3></td>
<td>Generated: Fri Apr 6 2018 11:42:04</td>
</tr></table>
</small></address>
</body>
</html>
