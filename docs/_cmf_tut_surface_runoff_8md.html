<!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>cmf: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <span id="projectlogo"><img alt="cmf - the catchment modelling framework" src="cmf-logo-klein.png"/></span>
  <span style="padding-left: 2em;">
   <span id="projectname">cmf
   &#160;<span id="projectnumber">1.2.1a0</span>
   </span>
   <span id="projectbrief">The Catchment Modelling Framework</span>
  </span>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="contents">
<div class="textblock"><p><a class="el" href="_cmf_tut_start_8md.html">index...</a> <a class="el" href="_cmf_tut2d_8md.html">next...</a></p>
<h1>Surface runoff</h1>
<h2>Surface water storage</h2>
<p>Cells can own a distinct storage for surface water, and usually this storage should exist. However, water that does not infiltrate directly might be routed to an outlet (model boundary), a river (see later part of the tutorial) or to the surface water of another cell.</p>
<p>The surface water of a cell has the class <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a>, and can either be created directly withe the cell:</p>
<div class="fragment"><div class="line">cell = project.NewCell(x=0,y=0,z=0,area=1000,with_surfacewater=True) </div></div><!-- fragment --><p>or afterwards, if the cell has not been created with surface water</p>
<div class="fragment"><div class="line">cell = project.NewCell(x=0,y=0,z=0,area=1000) </div><div class="line">cell.surfacewater_as_storage()</div></div><!-- fragment --><p>To route the water to the target, one can use conceptual connections like the <a class="el" href="classcmf_1_1water_1_1waterbalance__connection.html">waterbalance_connection</a>, if you want to ensure the surfacewater to be empty at all time, the generic <a class="el" href="classcmf_1_1water_1_1kinematic__wave.html">kinematic_wave</a> connection for linear and polynomal storages or the <a class="el" href="classcmf_1_1upslope_1_1connections_1_1_kinematic_surface_runoff.html">KinematicSurfaceRunoff</a> for a more "physical" approach. This type of connection is deemed to be the "normal" case and the <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a> exposes some properties to be used by that connection.</p>
<p>Using a diffusive wave, where sinks can fill up and water flows over the topographic gradient, is not numerically stable. Contributions are welcome.</p>
<h2>Kinematic surface runoff</h2>
<p>Surface runoff in cmf is usually modelled using the kinematic wave approximation of the St. Vernant equation for sheet flow using Manning friction loss:</p>
<p class="formulaDsp">
\[ [q|= d\ w\ d^{2/3} \frac{\sqrt{\tan \beta}}{n} 86400 \frac{sec}{day} \]
</p>
<p>]</p>
<p>where: - \(q\) is the surface flow in \(\frac{m^3}{day}\) - \(d\) is the "active" water depth in \(m\) - \(w\) is the width of the sheet flow - \(\tan \beta\) is the topographic slope - \(n\) is the Manning roughness</p>
<p>The "active" water depth is the average water depth where runoff starts. The idea behind a passive and an active water depth is, that prior to runof subscale sinks need to be filled up in form of puddles. Only when the puddles are filled, the runoff starts. The <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a> storage has a property <code>puddledepth</code> to characterize the average water depth needed to fill up the puddles. If runoff starts, when 20% of the surface is covered by (on average) 1cm deep puddles, the <code>puddledepth</code> is <code>\form#548@_fakenl</code>. The property <code>nManning</code> of the <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a> is also used.</p>
<h3>Example: A simple over flow routing to a boundary condition</h3>
<div class="fragment"><div class="line">import cmf</div><div class="line">from numpy import transpose</div><div class="line">from pylab import plot,show,subplot</div><div class="line"></div><div class="line">p = cmf.project()</div><div class="line"># Create cell with 1000m2 and surface water storage</div><div class="line">c = p.NewCell(0,0,1,1000,True)</div><div class="line"># Set puddle depth to 2mm</div><div class="line">c.surfacewater.puddledepth = 0.002</div><div class="line"># Add a thick layer, low conductivity. Use Green-Ampt-Infiltration</div><div class="line">c.add_layer(0.1, cmf.VanGenuchtenMualem(Ksat=0.1))</div><div class="line">c.install_connection(cmf.GreenAmptInfiltration)</div><div class="line"># Create outlet, 10 m from cell center, 1m below cell</div><div class="line">outlet = p.NewOutlet(&#39;outlet&#39;,10,0,0)</div><div class="line"># Create connection, distance is calculated from position</div><div class="line">con = cmf.KinematicSurfaceRunoff(c.surfacewater,outlet,flowwidth=10)</div><div class="line"># set rainfall, a good shower to get surface runoff for sure (100mm/day)</div><div class="line">c.set_rainfall(100.)</div><div class="line"># Create a solver</div><div class="line">solver = cmf.CVodeIntegrator(p,1e-8)</div><div class="line"></div><div class="line"># Calculate results</div><div class="line">Vsoil, Vsurf, qsurf,qinf = transpose([[(c.layers[0].volume,|c.surfacewater.volume, outlet(t), c.layers[0]](t)) </div><div class="line">                             for t in solver.run(cmf.Time(1,1,2012),cmf.Time(2,1,2012),cmf.min)])</div><div class="line"># Present results</div><div class="line">ax1=subplot(211)</div><div class="line">plot(Vsurf,label=&#39;Surface&#39;)</div><div class="line">plot(Vsoil,label=&#39;Soil&#39;)</div><div class="line">ylabel(&#39;Water content in mm&#39;)</div><div class="line">legend(loc=0)</div><div class="line">subplot(212,sharex=ax1)</div><div class="line">plot(qsurf,label=&#39;Surface&#39;)</div><div class="line">plot(qinf,label=&#39;Soil&#39;)</div><div class="line">ylabel(&#39;Flux in mm/day&#39;)</div><div class="line">xlabel(&#39;Time in minutes&#39;)</div><div class="line">legend(loc=0)</div></div><!-- fragment --><p>author: philipp, version: 2 Tue Jan 21 10:38:14 2014 </p>
</div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<div>&copy 2008-2017 by 
<a class="el" href="http://www.uni-giessen.de/hydro/kraft"> Philipp Kraft</a> and
<a class="el" href="http://www.uni-giessen.de/hydro"> 
Institute of Landscape Ecology and Resources Management,University of Gie&szlig;en</a>
</h3></td>
<td>Generated: Fri Apr 6 2018 11:42:04</td>
</tr></table>
</small></address>
</body>
</html>
